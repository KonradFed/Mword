<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HRMS – Dashboard</title>
  <link rel="stylesheet" th:href="@{/style.css}"/>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <div class="brand-icon">HR</div>
    <div class="brand-text">
      <h1>HRMS – Dashboard</h1>
      <p>Porównanie danych: PostgreSQL vs Neo4j</p>
    </div>
  </div>
</header>

<main class="page">
  <div class="two-col">
    <!-- ===================== LEWA KARTA: POSTGRES ===================== -->
    <section class="card">
      <div class="card-head">
        <h2>PostgreSQL: Pracownicy</h2>
        <div class="head-right" style="display:flex;gap:10px;align-items:center">
          <div class="chip">
            <span class="chip__label">PG time</span>
            <span class="chip__value"
                  th:text="${pgTimeMs != null and !T(java.lang.Double).isNaN(pgTimeMs)} ? ${#numbers.formatDecimal(pgTimeMs,1,2)} + ' ms' : '—'">—</span>
          </div>
          <span class="badge" th:text="${pgCount}">0</span>
        </div>
      </div>

      <div class="table-wrap">
        <div class="pager" style="display:flex;align-items:center;justify-content:space-between;padding:6px 4px;gap:8px">
          <div>Page <span th:text="${pgPage + 1}">1</span> of <span th:text="${pgPages}">1</span> • Total: <span th:text="${pgCount}">0</span></div>
          <div class="pager__btns" style="display:flex;gap:8px">
            <a class="btn ghost" th:classappend="${pgPage == 0} ? ' disabled'"
               th:href="@{'/dashboard'(pgPage=${T(java.lang.Math).max(0, pgPage-1)}, neoPage=${neoPage}, size=${size})}">Prev</a>
            <a class="btn ghost" th:classappend="${pgPage + 1 >= pgPages} ? ' disabled'"
               th:href="@{'/dashboard'(pgPage=${pgPage+1}, neoPage=${neoPage}, size=${size})}">Next</a>
          </div>
        </div>

        <table class="data data--wide">
          <thead>
          <tr>
            <th>Employee ID</th>
            <th>First name</th>
            <th>Last name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Hire date</th>
            <th>Department</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="r : ${pgRows}">
            <td th:text="${r.employeeId}">1</td>
            <td th:text="${r.firstName}">Jan</td>
            <td th:text="${r.lastName}">Kowalski</td>
            <td><a th:href="'mailto:'+${r.email}" th:text="${r.email}">mail</a></td>
            <td th:text="${r.phone}">600100200</td>
            <td th:text="${r.hireDate}">2020-01-15</td>
            <td th:text="${r.departmentName}">IT</td>
          </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ===================== ŚRODEK: AKCJE ===================== -->
    <aside class="actions">
      <div class="stack">
        <a class="btn" href="#" data-modal="add" id="btn-open-add">Add</a>
        <a class="btn" href="#" data-modal="edit">Edit</a>
        <a class="btn danger" href="#" data-modal="delete">Delete</a>
        <a class="btn ghost" th:href="@{/dashboard}">Refresh</a>
      </div>
      <p class="err" th:if="${lastError != null}" th:text="${lastError}" style="margin-top:12px;color:#ff99ad"></p>
    </aside>

    <!-- ===================== PRAWA KARTA: NEO4J ===================== -->
    <section class="card">
      <div class="card-head">
        <h2>Neo4j: Employees (graf)</h2>
        <div class="head-right" style="display:flex;gap:10px;align-items:center">
          <div class="chip alt">
            <span class="chip__label">Neo4j time</span>
            <span class="chip__value"
                  th:text="${neoTimeMs != null and !T(java.lang.Double).isNaN(neoTimeMs)} ? ${#numbers.formatDecimal(neoTimeMs,1,2)} + ' ms' : '—'">—</span>
          </div>
          <span class="badge" th:text="${neoCount}">0</span>
        </div>
      </div>

      <div class="table-wrap">
        <div class="pager" style="display:flex;align-items:center;justify-content:space-between;padding:6px 4px;gap:8px">
          <div>Page <span th:text="${neoPage + 1}">1</span> of <span th:text="${neoPages}">1</span> • Total: <span th:text="${neoCount}">0</span></div>
          <div class="pager__btns" style="display:flex;gap:8px">
            <a class="btn ghost" th:classappend="${neoPage == 0} ? ' disabled'"
               th:href="@{'/dashboard'(pgPage=${pgPage}, neoPage=${T(java.lang.Math).max(0, neoPage-1)}, size=${size})}">Prev</a>
            <a class="btn ghost" th:classappend="${neoPage + 1 >= neoPages} ? ' disabled'"
               th:href="@{'/dashboard'(pgPage=${pgPage}, neoPage=${neoPage+1}, size=${size})}">Next</a>
          </div>
        </div>

        <table class="data data--wide">
          <thead>
          <tr>
            <th>#</th>
            <th>ID</th>
            <th>First</th>
            <th>Last</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Hire date</th>
            <th>Title</th>
            <th>Min</th>
            <th>Max</th>
            <th>Dept</th>
            <th>Location</th>
            <th>Amount</th>
            <th>From</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="m, i : ${neoRows}"
              th:with="r=${m['row'] != null ? m['row'] : (m['item'] != null ? m['item'] : m)}">
            <td th:text="${i.index + 1 + (neoPage * size)}">1</td>
            <td th:text="${r['employeeId']}">1</td>
            <td th:text="${r['firstName']}">Jan</td>
            <td th:text="${r['lastName']}">Kowalski</td>
            <td><a th:href="'mailto:'+${r['email']}" th:text="${r['email']}">mail</a></td>
            <td th:text="${r['phone']}">600100200</td>
            <td th:text="${r['hireDate']}">2020-01-15</td>
            <td th:text="${r['title']}">Software Engineer</td>
            <td th:text="${r['minSalary']}">4000</td>
            <td th:text="${r['maxSalary']}">9000</td>
            <td th:text="${r['departmentName']}">IT</td>
            <td th:text="${r['location']}">Warszawa</td>
            <td th:text="${r['amount']}">6000</td>
            <td th:text="${r['fromDate']}">2020-01-15</td>
          </tr>
          <tr th:if="${#lists.isEmpty(neoRows)}">
            <td colspan="14" class="muted">Brak danych z Neo4j</td>
          </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</main>

<!-- ===================== MODAL: ADD (PG + Neo4j) ===================== -->
<dialog id="modal-add" class="modal">
  <form class="modal__card" th:action="@{/add-both}" method="post" novalidate>
    <header class="modal__head">
      <h3>Dodaj pracownika (PG + Neo4j)</h3>
      <button type="button" class="modal__close" aria-label="Zamknij">×</button>
    </header>

    <div class="modal__body grid">
      <label>First name
        <input name="firstName" required
               pattern="^[\\p{L}][\\p{L} .'-]{1,49}$"
               title="2–50 znaków, litery/spacje/kreski/kropki"/>
      </label>

      <label>Last name
        <input name="lastName" required
               pattern="^[\\p{L}][\\p{L} .'-]{1,49}$"
               title="2–50 znaków, litery/spacje/kreski/kropki"/>
      </label>

      <label>Email
        <input name="email" type="email" required
               pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$"
               title="np. jan.kowalski@firma.pl"/>
      </label>

      <label>Phone
        <input name="phone" pattern="^[0-9]{6,20}$"
               title="Tylko cyfry, 6–20 znaków"/>
      </label>

      <label>Hire date <input name="hireDate" type="date"/></label>

      <!-- Job ID NIE ma – tworzymy jobs auto, jeśli podasz Title/Min/Max -->
      <label>Title <input name="title" placeholder="np. Developer"/></label>

      <label>Min salary
        <input name="minSalary" type="number" step="1" min="0"
               title="Musi być mniejsze niż Max salary"/>
      </label>

      <label>Max salary
        <input name="maxSalary" type="number" step="1" min="0"/>
      </label>

      <label>Department (PG)
        <select name="departmentId" required>
          <option value="" disabled selected>— wybierz dział —</option>
          <option th:each="d : ${departments}"
                  th:value="${d.departmentId}"
                  th:text="${d.departmentName}">IT</option>
        </select>
      </label>

      <!-- Neo4j (opcjonalnie; jak puste – weźmiemy z PG departments) -->
      <label>Department name (Neo)
        <input name="departmentName" placeholder="jeśli puste, weźmiemy z PG"/>
      </label>
      <label>Location
        <input name="location" placeholder="jeśli puste, weźmiemy z PG"/>
      </label>

      <label>Amount
        <input name="amount" type="number" step="1" min="0"
               title="Kwota wynagrodzenia (>=0)"/>
      </label>

      <label>From date <input name="fromDate" type="date"/></label>
    </div>

    <footer class="modal__foot">
      <button class="btn" type="submit">Zapisz do PG + Neo4j</button>
      <button class="btn ghost" type="button" data-dismiss>Anuluj</button>
    </footer>
  </form>
</dialog>

<footer class="foot">2025 HRMS</footer>

<!-- JS (musi być w resources/static/app.js) -->
<script defer src="/app.js"></script>
</body>
</html>
